<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è–ªæ°´å°å·ï¼šFirebase å…¨çƒçˆ­éœ¸</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            text-align: center;
            background: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>ğŸ”¨</text></svg>") 16 0, auto;
        }

        /* --- è¨­å®šé¢æ¿ --- */
        #setupPanel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 450px;
            z-index: 10;
            max-height: 95vh;
            overflow-y: auto;
        }

        h1 { margin-top: 0; color: #d63031; font-size: 24px; }
        
        .input-group { margin: 12px 0; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        
        .radio-group { display: flex; gap: 15px; margin-bottom: 5px; }
        .radio-label { display: flex; align-items: center; cursor: pointer; font-size: 14px;}
        .radio-label input { margin-right: 5px; }

        input[type="text"], input[type="number"], select, input[type="file"] {
            padding: 8px;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        
        button {
            padding: 12px 0;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        
        button.start-btn { background: #d63031; color: white; flex: 2; }
        button.start-btn:hover { background: #c0392b; }

        button.rank-btn { background: #f1c40f; color: #333; flex: 1; }
        button.rank-btn:hover { background: #f39c12; }

        /* --- æ’è¡Œæ¦œ Modal --- */
        #rankModal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .close-btn {
            position: absolute; top: 10px; right: 15px;
            font-size: 24px; cursor: pointer; color: #888;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
        th { background-color: #f8f9fa; color: #666; }
        .rank-badge { 
            display: inline-block; width: 20px; height: 20px; 
            background: #ddd; color: white; text-align: center; 
            border-radius: 50%; line-height: 20px; font-size: 12px;
        }
        .top-1 { background: #f1c40f; }
        .top-2 { background: #bdc3c7; }
        .top-3 { background: #e67e22; }
        
        .loading-text { text-align: center; padding: 20px; color: #666; }

        /* --- éŠæˆ²é¢æ¿ --- */
        #gamePanel {
            display: none;
            width: 100%; height: 100%;
            flex-direction: column; position: relative;
        }

        .top-bar {
            background: #2d3436; padding: 8px 15px; color: #fff;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 5; font-size: 14px;
        }
        .money-counter { color: #00b894; font-weight: bold; font-size: 18px; }
        .timer-counter { color: #fab1a0; }
        .level-indicator { background: #d63031; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px;}

        .game-area {
            flex: 1; display: flex; width: 100%; position: relative; background-color: #dfe6e9;
        }

        .side {
            flex: 1; display: flex; justify-content: center; align-items: center;
            border-right: 1px dashed rgba(0,0,0,0.1); position: relative;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>ğŸ’¥</text></svg>") 16 0, pointer;
        }
        .side:last-child { border-right: none; }
        .side:active { background-color: rgba(255,0,0,0.1); }

        .target-box {
            width: 150px; height: 150px; display: flex; justify-content: center; align-items: center;
            font-size: 80px; user-select: none; transition: all 0.1s;
        }
        .target-box img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; pointer-events: none; }

        .pop-anim { animation: popIn 0.1s ease-out forwards; }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

        .mobile-controls { display: none; height: 100px; background: white; }
        .control-btn { flex: 1; font-size: 28px; border: none; color: white; font-weight: bold; border-radius: 0; }
        .btn-l { background: #0984e3; }
        .btn-r { background: #d63031; }
        @media (hover: none) and (pointer: coarse) { .mobile-controls { display: flex; } }
        
        .hint-text { position: absolute; bottom: 120px; width: 100%; text-align: center; color: #636e72; pointer-events: none; font-size: 12px; }
        @media (hover: none) and (pointer: coarse) { .hint-text { bottom: 10px; color: #b2bec3; z-index: 6; } }
    </style>
</head>
<body>

    <!-- è¨­å®šç•«é¢ -->
    <div id="setupPanel">
        <h1>ğŸ”¨ è–ªæ°´å°å·ï¼šå…¨çƒçˆ­éœ¸</h1>
        <p style="font-size:12px; color:#666;">Data Powered by Firebase</p>
        
        <div class="input-group">
            <label>ä½ çš„æš±ç¨±</label>
            <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥å¤§å" maxlength="10">
        </div>

        <div class="input-group">
            <label>ç¾åœ¨ç‹€æ…‹ï¼š</label>
            <div class="radio-group">
                <label class="radio-label"><input type="radio" name="workStatus" value="working" checked> ä¸Šç­ä¸­</label>
                <label class="radio-label"><input type="radio" name="workStatus" value="off"> å·²ä¸‹ç­</label>
            </div>
        </div>

        <div class="input-group">
            <label>æœˆè–ª (NT$)</label>
            <input type="number" id="salaryInput" value="45000">
        </div>

        <div class="input-group">
            <label>æœ€çµ‚æŒ‘æˆ°é€Ÿåº¦</label>
            <select id="speedSelect">
                <option value="1.0">1.0 ç§’ (ä¼‘é–’)</option>
                <option value="0.9">0.9 ç§’</option>
                <option value="0.8">0.8 ç§’</option>
                <option value="0.7">0.7 ç§’</option>
                <option value="0.6">0.6 ç§’</option>
                <option value="0.5" selected>0.5 ç§’ (æ¨™æº–)</option>
                <option value="0.4">0.4 ç§’ (å›°é›£)</option>
                <option value="0.3">0.3 ç§’ (ç…‰ç„)</option>
                <option value="0.2">0.2 ç§’ (ç¥äºº)</option>
                <option value="0.1">0.1 ç§’ (ä¸å¯èƒ½)</option>
            </select>
        </div>

        <div class="input-group">
            <label>ä¸Šå‚³è¨å­é¬¼ç…§ç‰‡ (é¸å¡«)</label>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <div class="btn-group">
            <button class="start-btn" id="startBtn">é–‹å§‹ç™¼æ´©</button>
            <button class="rank-btn" id="rankBtn">ğŸŒ å…¨çƒæ’è¡Œ</button>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œ Modal -->
    <div id="rankModal">
        <div class="modal-content">
            <span class="close-btn" id="closeRank">&times;</span>
            <h2 style="margin:0 0 10px 0;">ğŸŒ è–ªæ°´å°å·å…¨çƒæ’è¡Œ</h2>
            <div style="margin-bottom: 10px;">
                <label style="font-size:12px;">é¸æ“‡é€Ÿåº¦æŸ¥çœ‹ï¼š</label>
                <select id="rankFilter">
                    <option value="1.0">1.0 ç§’</option>
                    <option value="0.9">0.9 ç§’</option>
                    <option value="0.8">0.8 ç§’</option>
                    <option value="0.7">0.7 ç§’</option>
                    <option value="0.6">0.6 ç§’</option>
                    <option value="0.5" selected>0.5 ç§’</option>
                    <option value="0.4">0.4 ç§’</option>
                    <option value="0.3">0.3 ç§’</option>
                    <option value="0.2">0.2 ç§’</option>
                    <option value="0.1">0.1 ç§’</option>
                </select>
            </div>
            <div id="rankList">
                <div class="loading-text">è³‡æ–™è®€å–ä¸­...</div>
            </div>
        </div>
    </div>

    <div id="gamePanel">
        <div class="top-bar">
            <div>
                <span id="timeDisplay" class="timer-counter">0.0s</span>
                <span id="levelDisplay" class="level-indicator">Level 0/50</span>
            </div>
            <div class="money-counter" id="moneyDisplay">NT$ 0</div>
        </div>
        <div class="game-area">
            <div class="side" id="areaLeft"></div>
            <div class="side" id="areaRight"></div>
            <div class="hint-text">é›»è…¦æŒ‰å·¦å³éµ / æ‰‹æ©ŸæŒ‰ä¸‹æ–¹æŒ‰éˆ•</div>
        </div>
        <div class="mobile-controls">
            <button class="control-btn btn-l" id="btnLeft">â‡¦ å·¦</button>
            <button class="control-btn btn-r" id="btnRight">å³ â‡¨</button>
        </div>
    </div>

    <!-- 
      é‡è¦ï¼šé€™è£¡æ˜¯ Firebase æ•´åˆå€å¡Š 
      ä½¿ç”¨ ES Module è¼‰å…¥ï¼Œé€™åœ¨ GitHub Pages æˆ–ç¾ä»£ç€è¦½å™¨éƒ½èƒ½ç›´æ¥é‹ä½œã€‚
    -->
    <script type="module">
        // åŒ¯å…¥ Firebase SDK (ä½¿ç”¨å®˜æ–¹ CDN)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // âš ï¸ è«‹åœ¨é€™è£¡è²¼ä¸Šä½ çš„ firebaseConfig âš ï¸
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDA2iW_RO3beqS2H-oFS9slw-v9sJEJS0I",
            authDomain: "salary-thief-game.firebaseapp.com",
            projectId: "salary-thief-game",
            storageBucket: "salary-thief-game.firebasestorage.app",
            messagingSenderId: "731829535634",
            appId: "1:731829535634:web:cdbf4344cd6d7230cd774b"
        };

        // åˆå§‹åŒ– Firebase
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase Connected!");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            alert("Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Config æ˜¯å¦å¡«å¯«æ­£ç¢ºï¼");
        }

        // --- å…¨åŸŸè®Šæ•¸ (Global) ---
        // ç‚ºäº†è®“ module å…§çš„å‡½æ•¸èƒ½è¢« HTML onclick å‘¼å«ï¼Œæˆ‘å€‘éœ€è¦ç¶å®šåˆ° window
        window.initGame = initGame;
        window.fetchLeaderboard = fetchLeaderboard;
        window.handleInput = handleInput; 

        // DOM Elements
        const setupPanel = document.getElementById('setupPanel');
        const gamePanel = document.getElementById('gamePanel');
        const rankModal = document.getElementById('rankModal');
        const startBtn = document.getElementById('startBtn');
        const rankBtn = document.getElementById('rankBtn');
        const closeRank = document.getElementById('closeRank');
        const rankFilter = document.getElementById('rankFilter');
        
        const moneyDisplay = document.getElementById('moneyDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        
        const areaLeft = document.getElementById('areaLeft');
        const areaRight = document.getElementById('areaRight');
        const btnLeft = document.getElementById('btnLeft');
        const btnRight = document.getElementById('btnRight');

        let gameState = {
            playerName: 'ç„¡åæ°',
            salary: 0,
            perSecond: 0,
            status: 'working',
            startTime: 0,
            elapsed: 0,
            earned: 0,
            isPlaying: false,
            customImage: null,
            hitCount: 0
        };

        let gameLoop = {
            timer: null,
            moneyTimer: null,
            currentSide: null,
            targetSpeed: 0.5,
            initialSpeed: 1000,
            currentSpeed: 1000,
            totalLevels: 50,
            currentLevel: 0,
            msPerLevel: 0,
            lastLevelUpTime: 0,
            levelDuration: 10000,
            emojis: ['ğŸ‘¹', 'ğŸ‘º', 'ğŸ’©', 'ğŸ’€', 'ğŸ‘½', 'ğŸ¤¡', 'ğŸ§Ÿ', 'ğŸ§›'],
            lastEmojiIndex: -1
        };

        // Event Listeners
        startBtn.onclick = initGame;
        rankBtn.onclick = () => {
            rankModal.style.display = 'flex';
            rankFilter.value = document.getElementById('speedSelect').value;
            fetchLeaderboard();
        };
        closeRank.onclick = () => rankModal.style.display = 'none';
        window.onclick = (e) => { if (e.target == rankModal) rankModal.style.display = 'none'; };
        
        // Filter change event
        rankFilter.onchange = fetchLeaderboard;

        btnLeft.ontouchstart = (e) => { e.preventDefault(); handleInput('left'); };
        btnRight.ontouchstart = (e) => { e.preventDefault(); handleInput('right'); };
        btnLeft.onclick = () => handleInput('left');
        btnRight.onclick = () => handleInput('right');
        
        // Click on areas
        areaLeft.onmousedown = () => handleInput('left');
        areaRight.onmousedown = () => handleInput('right');

        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying) return;
            if (e.key === 'ArrowLeft') handleInput('left');
            if (e.key === 'ArrowRight') handleInput('right');
        });

        function initGame() {
            if (firebaseConfig.apiKey.includes("è«‹è²¼ä¸Š")) {
                alert("è«‹å…ˆæ‰“é–‹ index.html å¡«å…¥ Firebase Configï¼");
                return;
            }

            const nameVal = document.getElementById('playerName').value.trim();
            const salaryVal = parseFloat(document.getElementById('salaryInput').value);
            const targetSpeedVal = parseFloat(document.getElementById('speedSelect').value);
            const statusVal = document.querySelector('input[name="workStatus"]:checked').value;
            const fileInput = document.getElementById('imageInput');

            if (nameVal === "") { alert("è«‹è¼¸å…¥æš±ç¨±ï¼"); return; }
            if (!salaryVal || salaryVal <= 0) { alert('è«‹è¼¸å…¥æ­£ç¢ºæœˆè–ª'); return; }

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    gameState.customImage = e.target.result;
                    startGameLogic(nameVal, salaryVal, targetSpeedVal, statusVal);
                }
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                gameState.customImage = null;
                startGameLogic(nameVal, salaryVal, targetSpeedVal, statusVal);
            }
        }

        function startGameLogic(name, salary, targetSpeed, status) {
            gameState.playerName = name;
            gameState.salary = salary;
            gameState.perSecond = salary / (30 * 24 * 3600);
            gameState.status = status;
            gameState.isPlaying = true;
            gameState.hitCount = 0;
            
            gameLoop.initialSpeed = 1000;
            gameLoop.targetSpeed = targetSpeed;
            const targetMs = targetSpeed * 1000;
            gameLoop.msPerLevel = (gameLoop.initialSpeed - targetMs) / gameLoop.totalLevels;
            gameLoop.currentLevel = 0;
            gameLoop.currentSpeed = gameLoop.initialSpeed;
            
            setupPanel.style.display = 'none';
            gamePanel.style.display = 'flex';
            
            gameState.startTime = Date.now();
            gameLoop.lastLevelUpTime = gameState.startTime;
            
            gameLoop.moneyTimer = setInterval(updateStats, 50);
            nextRound();
        }

        function updateStats() {
            if(!gameState.isPlaying) return;
            const now = Date.now();
            gameState.elapsed = (now - gameState.startTime) / 1000;
            gameState.earned = gameState.elapsed * gameState.perSecond;
            
            timeDisplay.textContent = `${gameState.elapsed.toFixed(1)}s`;
            moneyDisplay.textContent = `NT$ ${gameState.earned.toFixed(2)}`;
            const lvlText = gameLoop.currentLevel >= 50 ? "MAX" : `${gameLoop.currentLevel}/${gameLoop.totalLevels}`;
            levelDisplay.textContent = `Lv. ${lvlText}`;
        }

        function nextRound() {
            if (!gameState.isPlaying) return;

            const now = Date.now();
            if (gameLoop.currentLevel < gameLoop.totalLevels) {
                if (now - gameLoop.lastLevelUpTime > gameLoop.levelDuration) {
                    gameLoop.currentLevel++;
                    gameLoop.lastLevelUpTime = now;
                    gameLoop.currentSpeed = gameLoop.initialSpeed - (gameLoop.currentLevel * gameLoop.msPerLevel);
                    levelDisplay.style.backgroundColor = '#f1c40f'; 
                    setTimeout(()=> levelDisplay.style.backgroundColor = '#d63031', 500);
                }
            } else {
                gameLoop.currentSpeed = gameLoop.targetSpeed * 1000;
            }

            areaLeft.innerHTML = ''; areaRight.innerHTML = '';
            const isRight = Math.random() > 0.5;
            gameLoop.currentSide = isRight ? 'right' : 'left';
            const targetDiv = isRight ? areaRight : areaLeft;
            targetDiv.appendChild(createContent());

            clearTimeout(gameLoop.timer);
            gameLoop.timer = setTimeout(() => {
                if (gameState.isPlaying) gameOver('timeout');
            }, gameLoop.currentSpeed);
        }

        function createContent() {
            const box = document.createElement('div');
            box.className = 'target-box pop-anim';
            const damageLevel = gameState.hitCount;
            const hue = Math.min(damageLevel * 8, 280); 
            const contrast = 1 + (damageLevel * 0.04);
            const rotate = (Math.random() * 40 - 20) + (damageLevel % 2 === 0 ? 10 : -10);
            
            let styleString = `transform: rotate(${rotate}deg) scale(${1 + damageLevel*0.005});`;
            if (gameState.hitCount > 0) {
                styleString += ` filter: contrast(${contrast}) hue-rotate(${hue}deg) sepia(0.3) saturate(2);`;
            }

            if (gameState.customImage) {
                const img = document.createElement('img');
                img.src = gameState.customImage;
                img.style = styleString;
                box.appendChild(img);
            } else {
                let newIndex;
                do { newIndex = Math.floor(Math.random() * gameLoop.emojis.length); } 
                while (newIndex === gameLoop.lastEmojiIndex);
                gameLoop.lastEmojiIndex = newIndex;
                const span = document.createElement('span');
                span.textContent = gameLoop.emojis[newIndex];
                span.style = styleString;
                box.appendChild(span);
            }
            return box;
        }

        function handleInput(userSide) {
            if (!gameState.isPlaying) return;
            if (userSide === gameLoop.currentSide) {
                gameState.hitCount++;
                const target = userSide === 'left' ? areaLeft : areaRight;
                const flash = document.createElement('div');
                flash.style = 'position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.6);pointer-events:none;';
                target.appendChild(flash);
                setTimeout(() => flash.remove(), 50);
                clearTimeout(gameLoop.timer);
                nextRound();
            } else {
                gameOver('wrong');
            }
        }

        async function gameOver(reason) {
            gameState.isPlaying = false;
            clearInterval(gameLoop.moneyTimer);
            clearTimeout(gameLoop.timer);

            const finalSeconds = parseFloat(gameState.elapsed.toFixed(2));
            const finalMoney = gameState.earned.toFixed(2);
            
            document.body.style.cursor = 'wait';

            // --- ä¸Šå‚³åˆ° Firebase ---
            try {
                // è³‡æ–™è¡¨åç¨±ï¼šscores
                await addDoc(collection(db, "scores"), {
                    name: gameState.playerName,
                    speed: gameLoop.targetSpeed.toString(), // å­˜æˆå­—ä¸²æ–¹ä¾¿æ¯”å°
                    time: finalSeconds,
                    money: finalMoney,
                    timestamp: serverTimestamp()
                });
                console.log("Score Uploaded to Firebase!");
            } catch (e) {
                console.error("Upload failed: ", e);
                alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Firebase è¨­å®š");
            }

            document.body.style.cursor = 'default';

            let title = reason === 'timeout' ? "å¤ªæ…¢äº†ï¼åæ‡‰ä¸åŠï¼ğŸ˜«" : "æ‰“éŒ¯é‚Šäº†ï¼æ‰‹æ®˜ï¼ğŸ˜µ";
            let msg = `${title}\n\nä½ å·²æµªè²»ç”Ÿå‘½ï¼š${finalSeconds} ç§’\n(Lv.${gameLoop.currentLevel})\n\n`;
            if (gameState.status === 'working') msg += `ğŸ‰ å·å¾—è–ªæ°´ï¼šNT$ ${finalMoney}`;
            else msg += `ğŸ’¸ å°‘è³ºé‡‘é¡ï¼šNT$ ${finalMoney}`;
            msg += `\n\n(æˆç¸¾å·²ä¸Šå‚³å…¨çƒæ’è¡Œ)`;

            document.body.style.backgroundColor = '#ffe6e6';
            setTimeout(() => {
                alert(msg);
                resetGame();
            }, 100);
        }

        function resetGame() {
            document.body.style.backgroundColor = '#f0f2f5';
            setupPanel.style.display = 'block';
            gamePanel.style.display = 'none';
            areaLeft.innerHTML = ''; areaRight.innerHTML = '';
            timeDisplay.textContent = '0.0s';
            moneyDisplay.textContent = 'NT$ 0';
        }

        async function fetchLeaderboard() {
            const listDiv = document.getElementById('rankList');
            const filterSpeed = document.getElementById('rankFilter').value;
            
            if (firebaseConfig.apiKey.includes("è«‹è²¼ä¸Š")) {
                listDiv.innerHTML = '<p style="color:red;">è«‹å…ˆè¨­å®š Firebase Config</p>';
                return;
            }

            listDiv.innerHTML = '<div class="loading-text">æ­£åœ¨å¾é›²ç«¯è®€å–è³‡æ–™...</div>';

            try {
                // æŸ¥è©¢é‚è¼¯ï¼šæ‰¾å‡º speed == é¸æ“‡çš„é€Ÿåº¦ï¼Œä¾ time é™åºï¼Œå–å‰ 10
                const q = query(
                    collection(db, "scores"), 
                    where("speed", "==", filterSpeed),
                    orderBy("time", "desc"),
                    limit(10)
                );

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    listDiv.innerHTML = '<p style="text-align:center;color:#888;">æ­¤é€Ÿåº¦å°šç„¡äººæŒ‘æˆ°ï¼Œå¿«ä¾†æ¶ç¬¬ä¸€ï¼</p>';
                    return;
                }

                let html = `<table>
                    <thead><tr><th style="width:40px;">#</th><th>ç©å®¶</th><th>ç§’æ•¸</th><th>é‡‘é¡</th></tr></thead>
                    <tbody>`;
                
                let index = 0;
                querySnapshot.forEach((doc) => {
                    const rec = doc.data();
                    let rankClass = '';
                    if(index === 0) rankClass = 'top-1';
                    else if(index === 1) rankClass = 'top-2';
                    else if(index === 2) rankClass = 'top-3';

                    html += `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">${index + 1}</span></td>
                        <td>${rec.name}</td>
                        <td style="font-weight:bold; color:#d63031;">${rec.time}s</td>
                        <td style="color:#27ae60;">$${rec.money}</td>
                    </tr>`;
                    index++;
                });
                html += '</tbody></table>';
                listDiv.innerHTML = html;

            } catch (e) {
                console.error("Fetch Error:", e);
                listDiv.innerHTML = '<p style="color:red;">è®€å–å¤±æ•—ã€‚<br>è«‹ç¢ºèª Firestore æ˜¯å¦å·²å»ºç«‹ç´¢å¼•(å¦‚æœæ§åˆ¶å°å ±éŒ¯) æˆ– æ¬Šé™æ˜¯å¦è¨­ç‚º Test Modeã€‚</p>';
            }
        }
    </script>
</body>
</html>
